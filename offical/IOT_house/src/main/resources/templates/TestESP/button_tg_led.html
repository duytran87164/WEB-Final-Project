<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>LED Control</h1>

        <!-- Nút để toggle trạng thái LED -->
        <button class="btn btn-primary" id="toggleButton" onclick="toggleLED()">Toggle LED</button>
        <p id="ledStatus">LED is OFF</p>  <!-- Hiển thị trạng thái LED -->

        <h2>Temperature from ESP</h2>
        <p id="temperatureStatus">Loading temperature...</p> <!-- Hiển thị nhiệt độ từ ESP -->

        <h2>Humidity from ESP</h2>
        <p id="humidityStatus">Loading humidity...</p> <!-- Hiển thị độ ẩm từ ESP -->
    </div>

    <script>
        // Hàm gửi yêu cầu POST đến server để toggle LED
        function toggleLED() {
            fetch('/api/toggleLedFromWeb', {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                // Cập nhật trạng thái LED trên giao diện người dùng
                document.getElementById('ledStatus').innerHTML = 'LED is ' + (data.ledStatus === 1 ? 'ON' : 'OFF');
            })
            .catch(error => console.error('Error toggling LED:', error));
        }

        // Hàm để làm mới trạng thái LED và nhiệt độ liên tục
        function updateStatus() {
            // Lấy trạng thái LED từ server
            fetch('/api/ledStatus')
            .then(response => response.json())
            .then(data => {
                document.getElementById('ledStatus').innerHTML = 'LED is ' + (data.ledStatus === 1 ? 'ON' : 'OFF');
            })
            .catch(error => console.error('Error fetching LED status:', error));

            // Lấy nhiệt độ từ ESP và hiển thị
            fetch('/api/getTemperature')
            .then(response => response.json())
            .then(data => {
                document.getElementById('temperatureStatus').innerHTML = 'Temperature: ' + data.temperature + ' °C';
            })
            .catch(error => console.error('Error fetching temperature:', error));

            // Lấy độ ẩm từ ESP và hiển thị
            fetch('/api/getTemperature')
            .then(response => response.json())
            .then(data => {
                document.getElementById('humidityStatus').innerHTML = 'Humidity: ' + data.humidity + ' %';
            })
            .catch(error => console.error('Error fetching humidity:', error));
        }

        // Gọi hàm updateStatus mỗi 5 giây (5000ms)
        setInterval(updateStatus, 5000);  // Cập nhật trạng thái LED, nhiệt độ và độ ẩm mỗi 5 giây

        // Gọi một lần ngay khi trang được tải để hiển thị thông tin ngay lập tức
        window.onload = updateStatus;
    </script>
</body>
</html>
